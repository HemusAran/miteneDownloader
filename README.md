# ● Fork元からの主な変更点
- v1.3.0
  - 自分にとって不要な処理の削除
  - ダウンロードの非同期並列処理でたびたびエラーが発生するため、sleepで若干タイミングをずらす
  - 保存先のフォルダに既にファイルがある場合はダウンロードをスキップ
  - 写真の拡張子 .webp 対応（ .webp のファイルを .jpeg としていると Windows フォトがうまく動かないため）
- v1.4.0
  - 動画もダウンロード可能に。並列ダウンロードは廃止。
- v1.5.0
  - 1 枚目のサムネイルを表示。ページが正しいか、セッションが生きているかの確認に使用。
  - プログラムのインデント修正。
- v1.6.0
  - サブ画面から CDATA を自動設定する仕組みを追加。



# miteneDownloader
Download jpg/webp/mp4 files from mitene

"みてね"にアップロードした画像・動画をまとめてダウンロードします。

1 度にダウンロードできるのはブラウザ版の 1 ページに表示されている 25 個の画像・動画です。そのため各ページごとにダウンロードの操作が必要です。

保存先のフォルダにすでにダウンロード済みのファイルがある場合はダウンロードをスキップします。


# ● 使用方法（CDATA 手動）
CDATA と呼ばれるデータを手動で取得する手順を記載。次の項では自動で取得する手順になっているため、基本的にはそちらの操作を行えば良い。

1) アプリケーション (miteneDownloader.exe) を起動する。

2) GoogleChrome で "みてねブラウザ版" のサイトにアクセスする。

       "みてねブラウザ版" にアクセスするには、みてねアプリから招待する。
       「家族設定」->「家族一覧」->「家族を招待する」->「ブラウザ版で招待」

3) （初回のみ）アプリケーションから "みてねブラウザ版" にログインする。

    1. アプリケーションの「 Sub Window Open 」ボタンの左にあるテキストボックスに "みてねブラウザ版" の URL を入れてボタンを押す。
 
    1. アプリケーションのサブ画面に "みてねブラウザ版" のログイン画面が表示されるのでログインする。

    1. ログイン後はサブ画面を閉じる。
       
           アプリケーションから "みてねブラウザ版" にログインすることで、
           認証情報が cookie に保存されるため次回から認証は不要。

4) GoogleChrome で "みてねブラウザ版" のダウンロードしたいページに移動する。

      （推奨）URL の末尾に以下のように追加することで任意のページを表示できる。

        ?page=13
        例）https://mitene.us/〇/〇〇〇〇〇〇?page=13

    この例だと、13 ページめが表示される。
      なお、「 ?page=1 」とすれば、先頭のページ（最新）が表示される。

5) GoogleChrome で上で右クリックして「ページのソースを表示」を選択する。

6) 表示されたソースの 3 行目（ window.gon={} で始まる行、以降 CDATA と呼ぶ）をコピーして、アプリケーションの「 Load 」ボタンの左側にあるテキストボックスにペーストする。

7) アプリケーションの「Load」ボタンを押す。

      "みてねブラウザ版" で表示したページの画像・動画の一覧が表示される。１つ目のファイルのみサムネイルを表示しているため、予定通りのサムネイルか目視で確認する。

       ファイル名は「撮影日時_連番」(yyyy-mm-ddThhmmss_連番)
       ファイル名の右の数字はファイルをアップロードしたユーザーID 

8) 「 Download All 」を押して画像・動画を DL する。

      ボタンを押すとダウンロード先のフォルダを選択するダイアログが表示される。
      
      Movie, Photo のチェックボックスを使うことで Movie のみ、Photo のみのダウンロードも可能。（ファイル１つずつの個別設定はなし）

      ダウンロードには有効期限があるため GoogleChrome で表示して時間が経過している場合、ダウンロードがうまくいかない場合は、5 の画面をリロードして 6,7,8 を再度行うこと。

9) 他のページのファイルをダウンロードするには、4 ～ 8 を繰り返す。



# ● 使用方法（CDATA 自動）
CDATA と呼ばれるデータを自動で取得する手順を記載。

1) "config_.ini" を "config.ini" の名前で複製する。

2) "config.ini" の中の url を "みてねブラウザ版" のサイトの URL に変更する。

3) アプリケーション (miteneDownloader.exe) を起動する。

4) GoogleChrome で "みてねブラウザ版" のサイトにアクセスする。

       "みてねブラウザ版" にアクセスするには、みてねアプリから招待する。
       「家族設定」->「家族一覧」->「家族を招待する」->「ブラウザ版で招待」

5) （初回のみ）アプリケーションから "みてねブラウザ版" にログインする。

    1. アプリケーションの「 Sub Window Open 」ボタンの左にあるテキストボックスに "みてねブラウザ版" のURLを入れてボタンを押す。
    
           2 にて url を設定している場合はテキストボックスに自動設定される。
 
    1. アプリケーションのサブ画面に "みてねブラウザ版" のログイン画面が表示されるのでログインする。

    1. ログイン後はサブ画面を閉じる。
       
           アプリケーションから "みてねブラウザ版" にログインすることで、
           認証情報が cookie に保存されるため次回から認証は不要。

6) 「 Sub Window Open 」でサブ画面に "みてねブラウザ版" を開く。

7) 「<- Prev 」「 Next ->」でダウンロードしたいページに移動する。

       サブ画面内に "みてねブラウザ版" の「前へ」「次へ」リンクが存在するが、
       アプリケーションとうまく連携できないため使用しないこと。

8) アプリケーションの「 Load (Sub Window) 」ボタンを押す。

      "みてねブラウザ版" で表示したページの画像・動画の一覧が表示される。 1 つ目のファイルのみサムネイルを表示しているため、目的のページのサムネイルか目視で確認する。

       ファイル名は「撮影日時_連番」(yyyy-mm-ddThhmmss_連番)
       ファイル名の右の数字はファイルをアップロードしたユーザーID 

9) 「 Download All 」を押して画像・動画を DL する。

      ボタンを押すとダウンロード先のフォルダを選択するダイアログが表示される。
      
      Movie, Photo のチェックボックスを使うことで Movie のみ、Photo のみのダウンロードも可能。（ファイル１つずつの個別設定はなし）

       ダウンロードには有効期限があるためサブ画面で表示して時間が経過している場合、
       ダウンロードがうまくいかない場合は、7,8 の操作で画面を更新すること。

10) 他のページのファイルをダウンロードするには、7 ～ 9 を繰り返す。



# ● 動作確認

- Windows 11
- Google Chrome



# ● 開発環境構築方法



## ○ Windows

1) Node.js (https://nodejs.org/) をインストール。

    LTS 版をインストールする。
    インストーラーでは、すべて「Next」を選択する。

    コマンドプロンプトにてバージョンが表示されるか確認する。

       node -v

2) yarn をインストール。

    コマンドプロンプトから以下を実行する。

       npm install -g yarn

    コマンドプロンプトにてバージョンが表示されるか確認する。

       yarn --version



## ○ Mac

1) Homebrew (https://brew.sh/index_ja) をインストールする。

2) nodebrew をインストールする。

       brew install nodebrew

3) Node.js をインストールする。

       nodebrew install-binary stable

    使用するバージョンを設定する。

    インストールされたバージョンを確認し、次にそのバージョンを使用するコマンドを打つ。

       nodebrew ls
       v16.7.0

       current: none

       nodebrew use v16.7.0
       use v16.7.0

4) Node.js のパスを環境変数に登録する。

       echo 'export PATH=$HOME/.nodebrew/current/bin:$PATH' >> ~/.zprofile

       source ~/.zprofile 

    コマンドプロンプトにてバージョンが表示されるか確認する。

       node -v

5) yarnをインストールする。

    コマンドプロンプトから以下を実行する。

       npm install -g yarn

    コマンドプロンプトにてバージョンが表示されるか確認する。

       yarn --version



# ● ビルド準備

    yarn install



# ● 実行手順

    yarn run start


# ● パッケージの作成手順

## ○ Windows

    yarn run build:win

## ○ Mac
      
    yarn run build:mac

